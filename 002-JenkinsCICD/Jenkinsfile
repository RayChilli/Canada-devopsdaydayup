pipeline {
    agent any 
    environment{
        registryUrl = "ghcr.io/chance2021/devopsdaydayup"
        #registryCredentialsId = credentials('github-token')
        commitID = sh(script: 'git rev-parse --short HEAD', returnStdout:true).trim()
    }
    stages {
        stage('Build Image') { 
            steps {
                // 
                sh"whoami"
                script {
                    dockerImage = docker.build("$registryUrl:$commitID","./002-JenkinsCICD")
                }
            }
        }
        stage('Push Image') { 
            steps {
                script {
                    docker.withRegistry("$registryUrl:$commitID", github-token) {
                        dockerImage.push()
                    }
                }
            }
        }
        stage('Deploy') { 
            steps {
                // 
                echo "This is Deploy"
               // script {
               //     docker.withRegistry( '', registryCredential ) {
               //     dockerImage.push()
               // }
            }
        }
    }
}
